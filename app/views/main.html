<!DOCTYPE html>
 
<html>
    <head>
        <title>SES: #{get 'title' /}</title>
        <meta charset="UTF-8">
       	<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/main.css'}">
       	<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/paging.css'}">
        <link rel="stylesheet" media="screen" href="@{'/public/stylesheets/smoothness/jquery-ui-1.8.16.custom.css'}">
        <link rel="stylesheet" media="screen" href="@{'/public/stylesheets/jqcloud.css'}">
        #{get 'moreStyles' /}
        <link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.png'}">
        <script src="@{'/public/javascripts/ajax-suggestion.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/jquery-1.6.2.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/jquery-ui-1.8.16.custom.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/jqcloud-0.2.4.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/commons.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        #{get 'moreScripts' /}
        
        <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=KEY" type="text/javascript"></script>
		<script type="text/javascript">
		  function initialize() {
		    if (GBrowserIsCompatible()) {
		      if(document.getElementById("map_canvas")!=null){
		     	 var map = new GMap2(document.getElementById("map_canvas"));
		     	 #{if service!=null && service.locationLat!=0 && service.locationLng!=0}
		    	  	map.setCenter(new GLatLng(${service.locationLat}, ${service.locationLng}), 10);
		    	  	var marker = new GMarker(new GLatLng(${service.locationLat}, ${service.locationLng}), {draggable: true});
		    	  #{/if}
		    	  #{else}
			      	map.setCenter(new GLatLng(41, 28), 4);
			      	var marker = new GMarker(new GLatLng(41, 32), {draggable: true});
			      #{/else}
			      map.setUIToDefault();        
			      map.addOverlay(marker);
			      
			      GEvent.addListener(marker, "drag", function(){
			    	  l=marker.getPoint();
			    	  $("input#locationLat").val(l.lat());
			    	  $("input#locationLng").val(l.lng());
			      });
		       }
		    }      
		  }
		</script>

    </head>
    <body onload="initialize()" onunload="GUnload()">
        <div id="fb-root"></div>
        <script type="text/javascript">
            window.fbAsyncInit = function() {
                /**
                 * Heroku Facebook App Id: 156593804437237
                 * Localhost Facebook App Id: 225538354166262
                 * BOUN Tomcat FB App Id: 269688619748482
                 */
                FB.init({appId: '225538354166262', status: true, cookie: true, xfbml: true});
            };
        </script>
        <script src="http://connect.facebook.net/en_US/all.js" type="text/javascript"></script>
        <div id="header">
            <div id="search-bar">
                #{form @Services.search()}
					<input type="hidden" name="searchDone" value="2"/>
		            #{field 'title'}
						<input type="text" id="${field.name}" name="${field.name}" class="${field.errorClass}" value="" />
					#{/field}
                	<input type="submit" name="search" value="Search Services" id="search">
                #{/form}
            </div>
            <div id="menu">
            #{if loggedIn}
                <div class="profile-pic">
                    <div class="default">
                        <a href="@{Profile.profile}">
                            #{if userObj.fbId}
                                <img src="http://graph.facebook.com/${userObj.fbId}/picture" />
                            #{/if}
                        </a>
                    </div>
                </div>
                Ol√°, <a href="@{Profile.profile}">${userObj.name}</a>! |
                #{if submenuView == null}
                    <span class="selected">
                #{/if}
                    <img class="icons" src="@{'/public/images/icons/dashboard.ico'}" />
                    <a href="@{Application.index}">Dashboard</a>
                #{if submenuView == null}
                    </span>
                #{/if} |
                #{list menuItems, as:'m'}
                    #{set additionalMenuMessage:'' /}
                    #{if submenuView == m.toLowerCase()}
                        <span class="selected">
                    #{/if}
                    <img class="icons" src="@{'/public/images/icons/' + m.toLowerCase().replace(" ", "-") + '.ico'}" />
                    <a href="
                    *{Burasi biraz pis oldu...}*
                    #{if m.toLowerCase() == "service types"}
                        @{Tasks.proposals}
                    #{/if}
                    #{elseif m.toLowerCase() == "messages"}
                        @{UserMessages.index}
                        #{if unreadMsgCount > 0}
                            #{set additionalMenuMessage: '(' + unreadMsgCount + ')' /}
                        #{/if}
                    #{/elseif}
                    #{elseif m.toLowerCase() == "activities"}
                        @{Activities.index}
                    #{/elseif}
                    #{else}
                        @{Services.list}
                    #{/else}
                    ">${m}</a><sup>${additionalMenuMessage}</sup>
                    #{if submenuView == m.toLowerCase()}
                        </span>
                    #{/if}
                    |
                #{/list}
                #{secure.check 'admin'}
                    <a href="/admin">Admin</a> |
                #{/secure.check}
                <a href="@{Secure.logout}">Logout</a>
            #{/if}
            #{else}
                <div class="fb-login-btn"></div>
            #{/else}
            </div>
            <div id="submenu">
                #{if submenuView != null}
                    #{include 'submenu/' + submenuView + '.html' /}
                #{/if}
            </div>
        </div>
        <div class="wrapper">
            <div id="pageContent">
                <div class="wikistyle">
                    <h1>#{get 'title' /}</h1>
                    #{if message != null}
                        <div class="flash-message">
                            ${message}
                        </div>
                    #{/if}
                    #{doLayout /}
                </div>
            </div>
        </div>
        <div id="footer">
            <a href="@{StaticPages.about}">About</a> | <a href="@{StaticPages.faq}">FAQ</a> | <a href="@{StaticPages.help}">Help</a>
        </div>
        <script type="text/javascript">
            $(document).ready(function(){
                $("span.radio-button span").bind("click", function() {
                    $(this).parent().find("input[type=radio]").click();
                });
                $("div.fb-login-btn").bind("click", function() {
                    FB.login(function(response) {
                        if (response.status == "connected") {
                            $.post(
                                "/fbLogin", {
                                    token: response.authResponse.accessToken
                                },
                                function(data) {
                                    document.location.href = "@{Application.index}";
                                }
                            );
                        } else {
                            console.log('User cancelled login or did not fully authorize.');
                        }
                    }, {scope: 'email'});
                });
            });
        </script>

    </body>
</html>
