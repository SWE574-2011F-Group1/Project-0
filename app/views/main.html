<!DOCTYPE html>
 
<html>
    <head>
        <title>#{get 'title' /}</title>
        <meta charset="UTF-8">
       	<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/main.css'}">
        <link rel="stylesheet" media="screen" href="@{'/public/stylesheets/smoothness/jquery-ui-1.8.16.custom.css'}">
        <link rel="stylesheet" media="screen" href="@{'/public/stylesheets/jqcloud.css'}">
        #{get 'moreStyles' /}
        <link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.png'}">
        <script src="@{'/public/javascripts/ajax-suggestion.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/jquery-1.6.2.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/jquery-ui-1.8.16.custom.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/jqcloud-0.2.4.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        <script src="@{'/public/javascripts/commons.js'}" type="text/javascript" charset="${_response_encoding}"></script>
        #{get 'moreScripts' /}
    </head>
    <body>
        <div id="fb-root"></div>
        <script type="text/javascript">
            window.fbAsyncInit = function() {
                /**
                 * Heroku Facebook App Id: 156593804437237
                 * Localhost Facebook App Id: 225538354166262
                 */
                FB.init({appId: '225538354166262', status: true, cookie: true, xfbml: true});
            };
        </script>
        <script src="http://connect.facebook.net/en_US/all.js" type="text/javascript"></script>
        <div id="header">
            <div style="float: right; margin-right: 10px;">
                #{form @Services.search()}
					<input type="hidden" name="searchDone" value="2"/>
		            #{field 'title'}
						<input type="text" id="${field.name}" name="${field.name}" class="${field.errorClass}" value="" />
					#{/field}
                	<input type="submit" name="search" value="Search Services" id="search">
                #{/form}
            </div>
            #{if loggedIn}
                Welcome ${user_name} |
                <a href="@{Services.index}">Add Service</a> |
                <a href="@{Services.list}">Services</a> |
                <a href="@{Services.search}">Detailed Search</a> |
                <a href="">Notifications (1)</a> |
                <a href="@{Profile.profile}">Profile</a> |
                <a href="@{UserMessages.index}">Messages</a> |
                <a href="@{Tasks.suggest}">Propose A Task</a> |
                <a href="@{Tasks.proposals}">Task Proposals</a> |
                #{secure.check 'admin'}
                    <a href="/admin">Admin</a> |
                #{/secure.check}
                <a href="@{Secure.logout}">Logout</a>
            #{/if}
            #{else}
                <div class="fb-login-btn"></div>
            #{/else}
        </div>
        <div class="wrapper">
            <div id="pageContent">
                <div class="wikistyle">
                    <h1>#{get 'title' /}</h1>
                    #{doLayout /}
                </div>
            </div>
        </div>
        <script type="text/javascript">
            $(document).ready(function(){
                $("span.radio-button span").bind("click", function() {
                    $(this).parent().find("input[type=radio]").click();
                });
                $("div.fb-login-btn").bind("click", function() {
                    FB.login(function(response) {
                        if (response.status == "connected") {
                            $.post(
                                "/fbLogin", {
                                    token: response.session.access_token
                                },
                                function(data) {
                                    document.location.href = "/";
                                }
                            );
                        } else {
                            console.log('User cancelled login or did not fully authorize.');
                        }
                    }, {perms: 'email'});
                })
            });
        </script>
    </body>
</html>
